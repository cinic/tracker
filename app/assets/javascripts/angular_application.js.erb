//= require_self
//= require_tree ./angular

var Zoomator = angular.module("Zoomator", 
                              ['templates', 'angularMoment', 'yaMap', 'ipCookie', 
                              'ui.router', 'angular-loading-bar', 'angular-duration-format'])
  .config(function($stateProvider){
    $stateProvider.state("Base", {
      url: "/"
    });

    $stateProvider.state("Modal", {
      views:{
        "modal": {
          templateUrl: "modal.html"
        }
      },
      onEnter: function($state){
        // Hitting the ESC key closes the modal
        $(document).on('keyup', function(e){
          if(e.keyCode == 27){
            $(document).off('keyup')
            $state.go('Base')
          }
        });

        // Clicking outside of the modal closes it
        $(document).on('click', '.Modal-backdrop, .Modal-holder', function() {
          $state.go('Base');
        });

        // Clickin on the modal or it's contents doesn't cause it to close
        $(document).on('click', '.Modal-box, .Modal-box *', function(e) {
          e.stopPropagation();
        });
      },
      abstract: true,
      url: "/deviceSettings/:deviceId"
    });

    $stateProvider.state("Modal.deviceSettings", {
      views:{
        "modal": {
          templateUrl: "device_settings.html",
          controller: "DeviceSettings"
        },
      params: ["deviceId"]
      }
    });

    $stateProvider.state("Modal.success", {
      views:{
        "modal": {
          templateUrl: "modals/success.html"
        }
      }
    });

    // device monitoring routes
    
    $stateProvider
      .state("all", {
        url: '/all',
        templateUrl: 'all.html'
      })
      .state("modes", {
        url: '/modes',
        templateUrl: 'modes.html'
      })
      .state("performance", {
        url: '/performance',
        templateUrl: 'performance.html'
      })
      .state("ctime", {
        url: '/ctime',
        templateUrl: 'ctime.html'
      })
      .state("consumption", {
        url: '/consumption',
        templateUrl: 'consumption.html'
      })
  })
  .constant('appenv', '<%= Rails.env %>')
  .constant('host', '<%= Rails.env == "development" ? "http://localhost:5001" : "http://api2.zoomator.com" %>');

